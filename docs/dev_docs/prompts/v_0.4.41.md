You will have to work on the files downloaded from this repo https://github.com/coasting-nc/LMUFFB and start working on the tasks described below. Therefore, if you haven't done it already, clone this repo https://github.com/coasting-nc/LMUFFB and start working on the tasks described below.

Please initialize this session by following the **Standard Task Workflow** defined in `AGENTS.md`.

1.  **Sync**: Run `git fetch && git reset --hard origin/main` for the LMUFFB repository to ensure you see the latest files.
2.  **Load Memory**: Read `AGENTS_MEMORY.md` from the root dir of the LMUFFB repository to review build workarounds and architectural insights. 
3.  **Load Rules**: Read `AGENTS.md` from the root dir of the LMUFFB repository to confirm instructions. 

Once you have reviewed these documents, please proceed with the following task:

**Task: Implement Dynamic Notch Filter & Frequency Estimator**

**Reference Documents:**
*   `docs/dev_docs/Fix LMU FFB Vibration (Analysis & Implementation Plan).md` (Primary Source of Truth)
*   `FFBEngine.h` (Core Logic)
*   `src/GuiLayer.cpp` (UI)

**Context:**
Users have reported constant, speed-dependent vibrations (likely tire flat spots or polygon issues) in Le Mans Ultimate. Standard smoothing adds too much latency. We need to implement a "surgical" solution: a **Speed-Tracking Notch Filter** that removes only the wheel rotation frequency. Additionally, we need a **Frequency Estimator** in the debug window to help users diagnose these vibrations.

**Implementation Requirements:**

1.  **Core Physics (`FFBEngine.h`):**
    *   Define the `BiquadNotch` struct as specified in the reference document.
    *   Implement the **Frequency Estimator** logic (Zero-Crossing detection on AC component) at the start of `calculate_force`.
    *   Implement the **Dynamic Notch Filter** logic: calculate wheel frequency from speed/radius, update filter coefficients, and process the `game_force`.
    *   Update `FFBSnapshot` to include `debug_freq` for visualization.

2.  **Configuration (`src/Config.h` & `src/Config.cpp`):**
    *   Add `flatspot_suppression` (bool) and `notch_q` (float) to the `Preset` struct.
    *   Implement persistence (Save/Load) for these new settings.
    *   Update default presets to initialize these values (Default: `false`, `Q=2.0`).

3.  **User Interface (`src/GuiLayer.cpp`):**
    *   **Tuning Window:** Add a new "Signal Filtering" tree node. Add the checkbox for "Dynamic Flatspot Suppression" and a slider for "Notch Width (Q)" (Range 0.5 - 10.0).
    *   **Debug Window:** In the "Raw Game Telemetry" section, display the `Est. Vibration Freq` (from the estimator) and the `Theoretical Wheel Freq` (calculated from speed).

4.  **Testing (`tests/test_ffb_engine.cpp`):**
    *   Add `test_notch_filter_attenuation()` to verify the filter kills the target frequency but passes others.
    *   Add `test_frequency_estimator()` to verify the zero-crossing logic detects a known sine wave input.

**Deliverables:**
*   Updated `FFBEngine.h`
*   Updated `src/Config.h` and `src/Config.cpp`
*   Updated `src/GuiLayer.cpp`
*   Updated `tests/test_ffb_engine.cpp`
*   Updated `CHANGELOG.md`

**Check-list for completion:**
- [ ] `BiquadNotch` struct implemented correctly in `FFBEngine.h`.
- [ ] Frequency Estimator logic added to `calculate_force`.
- [ ] Notch Filter logic added to `calculate_force` (dependent on `m_flatspot_suppression`).
- [ ] `FFBSnapshot` updated to carry frequency data to GUI.
- [ ] Config system saves/loads `flatspot_suppression` and `notch_q`.
- [ ] GUI displays new controls in "Signal Filtering" section.
- [ ] GUI displays frequency readouts in Debug Window.
- [ ] Unit tests passed for both Filter and Estimator.

### Git / Large Diff Issue
*   **Issue:** `git status`, `git fetch`, or other commands may fail with "The diff size is unusually large" if the repository state is significantly different or if build artifacts are not ignored.
*   **Workaround:** Rely on `read_file`, `overwrite_file`, and `replace_with_git_merge_diff` directly. Do not depend on bash commands for verification if this error occurs. Ensure `.gitignore` covers all build directories (e.g., `tests/build/`).

#### Git & Repo Management

##### Submodule Trap
*   **Issue:** Cloning a repo inside an already initialized repo (even if empty) can lead to nested submodules or detached git states.
*   **Fix:** Ensure the root directory is correctly initialized or cloned into. If working in a provided sandbox with `.git`, configure the remote and fetch rather than cloning into a subdirectory.

##### File Operations
*   **Lesson:** When moving files from a nested repo to root, ensure hidden files (like `.git`) are handled correctly or that the root `.git` is properly synced.
*   **Tooling:** `replace_with_git_merge_diff` requires exact context matching. If files are modified or desynchronized, `overwrite_file_with_block` is safer.
